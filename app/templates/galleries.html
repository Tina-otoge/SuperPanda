{% extends "base.html" %}
{% set json = url_for('.galleries_json') %}

{% block content %}
<form id="galleries-search">
	<div class="form-input">
		<label for="search">Search</label>
		<input name="search" id="search" value="{{ request.args.get('search', '') }}">
	</div>
	<div class="form-input checkboxes">
		{% for name in filters_list %}
		{% with id = "filter-" + name %}
		<input id="{{ id }}" type="checkbox" name="filters" value="{{ name }}"
			{% if name in filters %}
			checked
			{% endif %}
		>
		<label for="{{ id }}">{{ name|nameify }}</label>
		{% endwith %}
		{% endfor %}
	</div>
	<input type="submit" value="search">
</form>
<div id="galleries">
	{% for gallery in data %}
		{% with url = url_for('.gallery', id=gallery.id, token=gallery.token) %}
		<div class="gallery-entry {{ gallery.category }}">
			<a href="{{ url }}" class="title">{{ gallery.title }}</a>
			<main>
				<a href="{{ url }}" title="{{ gallery.title }}">
					<img src="{{ gallery.cover_url }}" class="cover">
				</a>
				<div class="all-tags">
					<div class="tags">
						{% for namespace, tags in gallery.tags_by_namespaces.items() %}
						<div class="tags-group {{ namespace }}">
							<span class="namespace">{{ namespace }}:</span>
							{% for tag in tags %}
							<span class="tag">{{ tag.value }}</span>
							{% endfor %}
						</div>
						{% endfor %}
					</div>
					<div class="super-tags">
						{% if gallery.language %}
							<span class="language">
								{{ gallery.language.value }}
								{% if gallery.is_translation %}(TR){% endif %}
							</span>
						{% endif %}
						<span class="category">{{ gallery.category }}</span>
					</div>
				</div>
			</main>
			<div class="sub-infos">
				{% if gallery.extracted_title %}
				<a href="{{ url }}" class="title" title="{{ gallery.title }}">{{ gallery.extracted_title }}</a>
				{% endif %}
				{% if gallery.full_artist %}
				<a href="{{ url_for('.galleries', search=gallery.artist) }}" class="artist" title="{{ gallery.full_artist }}">{{ gallery.full_artist }}</a>
				{% endif %}
			</div>
		</div>
		{% endwith %}
	{% endfor %}
</div>
{% endblock %}
